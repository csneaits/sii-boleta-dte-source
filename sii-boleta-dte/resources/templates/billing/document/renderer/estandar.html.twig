<html>
<head>
    <style>
        :root {
            --color-primary: #1f3c88;
            --color-accent: #0ea5e9;
            --color-text: #1f2937;
            --color-muted: #475569;
            --color-highlight: #ef4444;
            --color-surface: #ffffff;
            --color-surface-alt: #f8fafc;
            --color-divider: rgba(148, 163, 184, 0.35);
        }
        html {
            height: 100%;
        }
        body {
            margin: 0;
            font-family: 'Inter', 'Segoe UI', Tahoma, sans-serif;
            font-size: 10pt;
            min-height: 100%;
            background: linear-gradient(140deg, #eef2ff 0%, #f8fafc 100%);
            color: var(--color-text);
        }
        p {
            margin: 4px 0;
            color: var(--color-muted);
        }
        .bold {
            font-weight: 700;
            color: var(--color-text);
        }
        .label {
            font-weight: 600;
            color: var(--color-primary);
            width: 28%;
        }
        .document-wrapper {
            max-width: 960px;
            margin: 0 auto;
            background: var(--color-surface);
            border-radius: 18px;
            box-shadow: 0 30px 60px rgba(15, 23, 42, 0.12);
            padding: 18mm;
            display: flex;
            flex-direction: column;
            gap: 18pt;
            min-height: 100%;
            position: relative;
            overflow: hidden;
        }
        .document-wrapper::before,
        .document-wrapper::after {
            content: '';
            position: absolute;
            border-radius: 50%;
            pointer-events: none;
        }
        .document-wrapper::before {
            inset: -160px auto auto -200px;
            width: 380px;
            height: 380px;
            background: radial-gradient(circle at center, rgba(31, 60, 136, 0.22), transparent 70%);
        }
        .document-wrapper::after {
            inset: auto -180px -220px auto;
            width: 320px;
            height: 320px;
            background: radial-gradient(circle at center, rgba(14, 165, 233, 0.2), transparent 75%);
        }
        .container {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 16pt;
            width: 100%;
        }
        .container + .container {
            padding-top: 12pt;
            border-top: 1px solid var(--color-divider);
        }
        .container-detalles {
            margin-top: 18pt;
            display: flex;
            flex-direction: column;
            gap: 12pt;
        }
        .container-montos-globales {
            display: flex;
            justify-content: flex-end;
            margin-top: 12pt;
        }
        .container-observacion {
            font-size: 9pt;
            color: var(--color-muted);
            display: flex;
            align-items: flex-end;
        }
        .emisor-info {
            flex: 1.4;
        }
        .emisor-logo {
            max-width: 38mm;
            height: auto;
            border-radius: 10px;
            background: var(--color-surface);
            box-shadow: 0 18px 30px rgba(15, 23, 42, 0.18);
            padding: 4px;
        }
        .emisor-razon-social {
            color: var(--color-primary);
            font-weight: 700;
            font-size: 15pt;
            margin-bottom: 3pt;
        }
        .emisor-giro {
            color: var(--color-muted);
            font-weight: 600;
            font-size: 10pt;
        }
        .emisor-direccion {
            color: var(--color-muted);
            font-size: 9.5pt;
        }
        .container-dte {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 12pt 16pt;
            border-radius: 18px;
            border: 1px solid rgba(31, 60, 136, 0.25);
            background: linear-gradient(135deg, rgba(31, 60, 136, 0.12), rgba(14, 165, 233, 0.12));
            text-transform: uppercase;
            color: var(--color-primary);
            gap: 6pt;
            min-width: 70mm;
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.6);
        }
        .dte-informacion {
            width: 100%;
            border: 1px dashed rgba(31, 60, 136, 0.4);
            border-radius: 12px;
            padding: 6pt 10pt;
            text-align: center;
            background: rgba(255, 255, 255, 0.85);
            font-size: 11pt;
        }
        .dte-informacion p {
            margin: 2pt 0;
            color: var(--color-primary);
        }
        .tipo-documento {
            font-size: 12pt;
            font-weight: 700;
            letter-spacing: 1px;
        }
        .sucursal-sii {
            margin-top: 6pt;
            font-size: 9pt;
            letter-spacing: 1px;
            color: var(--color-highlight);
            font-weight: 600;
        }
        .receptor-info {
            flex: 2.2;
        }
        .fechas {
            flex: 1;
            text-align: right;
            color: var(--color-muted);
        }
        .fechas p {
            color: var(--color-text);
            font-weight: 500;
        }
        .tabla-receptor {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed;
            font-size: 9.5pt;
        }
        .tabla-receptor td {
            padding: 3pt 5pt;
            border: none;
            color: var(--color-muted);
            word-break: break-word;
            white-space: normal;
        }
        .tabla-receptor .label {
            color: var(--color-primary);
        }
        .tabla-detalles {
            width: 100%;
            border-collapse: collapse;
            border-radius: 18px;
            overflow: hidden;
            border: 1px solid var(--color-divider);
            box-shadow: 0 22px 45px rgba(15, 23, 42, 0.12);
            background: rgba(255, 255, 255, 0.98);
            font-size: 9.5pt;
        }
        .tabla-detalles th {
            background: linear-gradient(135deg, rgba(31, 60, 136, 0.2), rgba(14, 165, 233, 0.18));
            color: var(--color-text);
            font-weight: 700;
            padding: 6pt 8pt;
            text-align: left;
            border-bottom: 1px solid var(--color-divider);
            white-space: nowrap;
        }
        .tabla-detalles th:nth-child(n+3),
        .tabla-detalles td:nth-child(n+3) {
            text-align: center;
        }
        .tabla-detalles td {
            padding: 5pt 6pt;
            border-bottom: 1px solid rgba(226, 232, 240, 0.8);
            color: var(--color-text);
            background: rgba(255, 255, 255, 0.96);
            white-space: nowrap;
        }
        .tabla-detalles tbody tr:nth-child(even) td {
            background: rgba(248, 250, 252, 0.95);
        }
        .tabla-detalles tbody tr:last-child td {
            border-bottom: none;
        }
        .tabla-montos {
            width: 80%;
            margin-left: auto;
            border-collapse: collapse;
            border-radius: 14px;
            overflow: hidden;
            background: rgba(248, 250, 252, 0.95);
            box-shadow: 0 14px 28px rgba(15, 23, 42, 0.1);
        }
        .tabla-montos td {
            padding: 5pt 8pt;
            font-weight: 600;
            color: var(--color-text);
            text-align: right;
        }
        .tabla-montos td:first-child {
            text-align: left;
            color: var(--color-muted);
        }
        .tabla-montos-global {
            border: none;
            width: 60mm;
            font-size: 11pt;
            margin-left: auto;
        }
        .tabla-montos-global td {
            padding: 3pt 6pt;
            font-weight: 700;
            color: var(--color-text);
            text-align: right;
            white-space: nowrap;
        }
        .tabla-timbre {
            border-collapse: collapse;
            margin-right: auto;
        }
        .tabla-timbre td {
            border: none;
            text-align: center;
        }
        .tabla-timbre .timbre-text {
            font-size: 10pt;
            color: var(--color-muted);
            margin: 2pt 0;
        }
        .tabla-timbre .img-timbre {
            margin: 0;
            padding: 0;
            height: auto;
        }
        .tabla-bottom-element {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed;
            margin-top: auto;
        }
        .tabla-bottom-element > tbody > tr {
            height: 100%;
        }
        .tabla-bottom-element td {
            border: none;
            vertical-align: top;
            padding: 0 6pt;
        }
        .tabla-bottom-element-cell {
            width: 33%;
        }
        .tabla-bottom-element-cell table {
            border-collapse: collapse;
            width: 100%;
        }
        .informacion-bottom {
            display: flex;
            gap: 12pt;
        }
        .montos {
            text-align: right;
            width: 60%;
            font-weight: 600;
            font-size: 11pt;
            color: var(--color-text);
        }
        .montos div {
            margin-bottom: 5px;
        }
        .montos span {
            display: inline-block;
            min-width: 110px;
        }
        .acuse-recibo {
            width: 100%;
            border-collapse: collapse;
            border-radius: 14px;
            overflow: hidden;
            border: 1px solid var(--color-divider);
            box-shadow: 0 15px 30px rgba(15, 23, 42, 0.12);
            background: rgba(255, 255, 255, 0.98);
        }
        .acuse-recibo td {
            padding: 6pt 8pt;
            vertical-align: bottom;
            text-align: left;
            color: var(--color-text);
        }
        .acuse-recibo .acuse-title {
            text-align: center;
            font-weight: 700;
            font-size: 10pt;
            color: var(--color-primary);
            padding: 10pt 8pt;
        }
        .acuse-recibo .acuse-recibo-label {
            text-align: justify;
            width: 92%;
            margin: 6pt auto 0;
            font-size: 8.5pt;
            color: var(--color-muted);
        }
        .acuse-recibo .linea {
            width: 70%;
            border-bottom: 1px solid var(--color-divider);
            margin-top: 14pt;
        }
        .graph-img {
            border: 1px solid var(--color-divider);
            border-radius: 12px;
            height: 150px;
            text-align: center;
            background: var(--color-surface-alt);
            padding: 6pt;
        }
        .container-cedible {
            display: flex;
            justify-content: flex-end;
            margin-top: 14pt;
        }
        .cedible {
            font-size: 15pt;
            color: var(--color-primary);
            letter-spacing: 4px;
            font-weight: 700;
            margin-left: auto;
        }
        footer {
            text-align: center;
            font-weight: 600;
            font-size: 9pt;
            border-top: 1px solid var(--color-divider);
            padding: 8pt 0;
            margin-top: auto;
            color: var(--color-muted);
        }
        footer a {
            color: inherit;
        }
        @media screen {
            body {
                font-size: 11pt;
                padding: 12px;
            }
            .document-wrapper {
                padding: 24mm;
            }
            .tabla-detalles th,
            .tabla-detalles td {
                font-size: 10pt;
            }
            .container {
                flex-wrap: wrap;
            }
            .container-dte {
                margin-left: auto;
            }
            .dte-informacion p {
                margin: 4pt 0;
            }
            .informacion-bottom {
                width: 100%;
            }
        }
        @media print {
            @page {
                size: 216mm 279mm;
                margin: 15mm;
            }
            body {
                background: #ffffff;
                font-size: 10pt;
                padding: 0;
            }
            .document-wrapper {
                box-shadow: none;
                border-radius: 0;
                margin: 0;
                padding: 0;
                gap: 12pt;
            }
            .document-wrapper::before,
            .document-wrapper::after {
                display: none;
            }
            .container + .container {
                border-top: none;
                padding-top: 10pt;
            }
            .tabla-detalles {
                box-shadow: none;
            }
            .container-dte {
                box-shadow: none;
                background: transparent;
                border-color: rgba(31, 60, 136, 0.35);
            }
            .dte-informacion {
                background: #ffffff;
            }
            .container-cedible {
                position: fixed;
                bottom: 0;
                right: 0;
                left: 0;
                padding: 0 15mm 5mm;
            }
            footer {
                position: absolute;
                bottom: 0;
                left: 0;
                right: 0;
                background: #fff;
                padding: 5mm 0;
                margin: 0;
            }
        }
    </style>
</head>
    <body>
        <div class="document-wrapper">
        <div class="container">
            {# Información del Emisor #}
            <div class="emisor-info">
                {# Logotipo #}
                {% if document.logo is not empty %}
                    <img src="{{ document.logo }}" alt="Logotipo Emisor" class="emisor-logo">
                {% endif %}
                {# Razón Social del Emisor #}
                <p class="emisor-razon-social">
                    {{ document.Encabezado.Emisor.RznSoc
                        | default(document.Encabezado.Emisor.RznSocEmisor) }}
                </p>
                {# Giro del Emisor #}
                <p class="emisor-giro">
                    {{ document.Encabezado.Emisor.GiroEmis
                        | default(document.Encabezado.Emisor.GiroEmisor) }}
                </p>
                {# Dirección del Emisor #}
                <p class="emisor-direccion">
                    {{ [document.Encabezado.Emisor.DirOrigen, document.Encabezado.Emisor.CmnaOrigen]
                        | filter(v => v is not empty)
                        | join(', ')
                    }}
                </p>
            </div>
            <div class="container-dte">
                {# Información del DTE #}
                <div class="dte-informacion">
                    <p>
                        R.U.T.: {{ document.Encabezado.Emisor.RUTEmisor
                            | format_as('billing_document.RUTEmisor') }}
                    </p>
                    <p class="tipo-documento">
                        {{ document.Encabezado.IdDoc.TipoDTE
                            | format_as('billing_document.TipoDTE') }}
                    </p>
                    <p>
                        N° {{ document.Encabezado.IdDoc.Folio }}
                    </p>
                </div>
                {# Sucursal SII #}
                <p class="sucursal-sii">
                    S.I.I. - {{ document.Encabezado.Emisor.CmnaOrigen
                    | format_as('billing_document.CdgSIISucur') }}
                </p>
            </div>
        </div>
        <div class="container">
            {# Información del Receptor #}
            <div class="receptor-info">
                <table class="tabla-receptor">
                    <tbody>
                        {# Información del Receptor #}
                        {% if document.Encabezado.Receptor.RUTRecep != '66666666-6' %}
                            <tr>
                                <td class="label">R.U.T.:</td>
                                <td>
                                    {{ document.Encabezado.Receptor.RUTRecep
                                        | format_as('billing_document.RUTRecep') }}
                                    </td>
                            </tr>
                        {% endif %}
                        {# Razón Social #}
                        {% if document.Encabezado.Receptor.RznSocRecep is not empty %}
                            <tr>
                                <td class="label">Razón Social:</td>
                                <td>
                                    {{ document.Encabezado.Receptor.RznSocRecep }}
                                </td>
                            </tr>
                        {% endif %}
                        {# Giro #}
                        {% if document.Encabezado.Receptor.GiroRecep is not empty %}
                        <tr>
                            <td class="label">Giro:</td>
                            <td>
                                {{ document.Encabezado.Receptor.GiroRecep }}
                            </td>
                        </tr>
                        {% endif %}
                        {# Dirección #}
                        {% if document.Encabezado.Receptor.DirRecep is not empty %}
                            <tr>
                                <td class="label">Dirección:</td>
                                <td>
                                    {{
                                        [
                                            document.Encabezado.Receptor.DirRecep,
                                            document.Encabezado.Receptor.CmnaRecep,
                                            document.Encabezado.Receptor.CiudadRecep
                                        ]
                                        | filter(v => v is not empty)
                                        | join(', ')
                                    }}
                                </td>
                            </tr>
                        {% endif %}
                        {# Tipo de Operación #}
                        {% if document.Encabezado.IdDoc.IndTraslado is not empty %}
                            <tr>
                                <td class="label">Tipo oper.:</td>
                                <td>
                                    {{ document.Encabezado.IdDoc.IndTraslado
                                        | format_as('billing_document.IndTraslado') }}
                                </td>
                            </tr>
                        {% endif %}
                        {# Traslado #}
                        {% if document.Encabezado.Transporte is not empty %}
                            <tr>
                                <td class="label">Traslado:</td>
                                <td>
                                    A {{
                                        [
                                            document.Encabezado.Transporte.DirDest,
                                            document.Encabezado.Transporte.CmnaDest
                                        ] | filter(v => v is not empty) | join(', ')
                                    }}
                                    {% if document.Encabezado.Transporte.RUTTrans is not empty %}
                                        por {{ document.Encabezado.Transporte.RUTTrans | format_as('billing_document.RUTTrans') }}
                                    {% endif %}
                                    {% if document.Encabezado.Transporte.Patente is not empty %}
                                        en vehículo {{ document.Encabezado.Transporte.Patente }}
                                    {% endif %}
                                    {% if document.Encabezado.Transporte.Chofer.NombreChofer is not empty %}
                                        con chofer {{ document.Encabezado.Transporte.Chofer.NombreChofer }}
                                        {% if document.Encabezado.Transporte.Chofer.RUTChofer is not empty %}
                                            ({{ document.Encabezado.Transporte.Chofer.RUTChofer | format_as('billing_document.RUTChofer') }})
                                        {% endif %}
                                    {% endif %}
                                </td>
                            </tr>
                        {% endif %}
                        {# Transporte #}
                        {% if document.Encabezado.Transporte.Aduana.CodViaTransp is not empty %}
                            <tr>
                                <td class="label">Traslado:</td>
                                <td>
                                    {{ document.Encabezado.Transporte.Aduana.CodViaTransp
                                        | format_as('billing_document.CodViaTransp') }}
                                </td>
                            </tr>
                        {% endif %}
                        {# País receptor #}
                        {% if document.Encabezado.Transporte.Aduana.CodPaisRecep is not empty %}
                            <tr>
                                <td class="label">P. receptor:</td>
                                <td>
                                    {{ document.Encabezado.Transporte.Aduana.CodPaisRecep
                                        | format_as('billing_document.CodPaisRecep') }}
                                </td>
                            </tr>
                        {% endif %}
                        {# Total bultos #}
                        {% if document.Encabezado.Transporte.Aduana.TotBultos is not empty %}
                            <tr>
                                <td class="label">Total bultos:</td>
                                <td>{{ document.Encabezado.Transporte.Aduana.TotBultos }}</td>
                            </tr>
                        {% endif %}
                        {# Contacto #}
                        {% if document.Encabezado.Receptor.CorreoRecep is not empty or document.Encabezado.Receptor.Contacto is not empty %}
                            <tr>
                                <td class="label">Contacto:</td>
                                <td>
                                    {{ document.Encabezado.Receptor.CorreoRecep }}
                                    {{ document.Encabezado.Receptor.Contacto }}
                                </td>
                            </tr>
                        {% endif %}
                        {# Nacionalidad #}
                        {% if document.Encabezado.Receptor.Extranjero.Nacionalidad is not empty %}
                            <tr>
                                <td class="label">Nacionalidad:</td>
                                <td>
                                    {{ document.Encabezado.Receptor.Extranjero.Nacionalidad
                                        | format_as('billing_document.Nacionalidad') }}
                                </td>
                            </tr>
                        {% endif %}
                        {# Cód. recep #}
                        {% if document.Encabezado.Receptor.CdgIntRecep is not empty %}
                            <tr>
                                <td class="label">Cód. recep.:</td>
                                <td>
                                    {{ document.Encabezado.Receptor.CdgIntRecep }}
                                </td>
                            </tr>
                        {% endif %}
                        {# Referencias #}
                        {% if document.Referencia is not empty %}
                            {% for referencia in document.Referencia %}
                            <tr>
                                <td class="label">Referencia:</td>
                                <td>
                                    {{ loop.index }} -
                                    {% if referencia.TpoDocRef is not empty %}
                                        {{ referencia.TpoDocRef | format_as('billing_document.TpoDocRef') }}
                                    {% endif %}
                                    {% if referencia.FolioRef is defined and referencia.IndGlobal != 1 %}
                                        N°{{ referencia.FolioRef }}
                                    {% endif %}
                                    {% if referencia.FchRef is not empty %}
                                        del {{ referencia.FchRef | format_as('billing_document.FchRef') }}
                                    {% endif %}
                                    {% if referencia.RazonRef is not empty %}
                                        : {{ referencia.RazonRef }}
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        {% endif %}
                    </tbody>
                </table>

            </div>
            <div class="fechas">
                {# Fecha de Emisión -#}
                <p class="bold">
                    {{ document.Encabezado.IdDoc.FchEmis
                        | format_as('billing_document.FchEmis')  }}
                </p>
                {# Fecha de Vencimiento -#}
                {% if document.Encabezado.IdDoc.FchVenc is not empty %}
                    <p>
                        Vence el {{ document.Encabezado.IdDoc.FchVenc
                            | format_as('billing_document.FchVenc')  }}
                    </p>
                {% endif %}
                {# Período Desde/Hasta -#}
                {% if document.Encabezado.IdDoc.PeriodoDesde is not empty and
                    document.Encabezado.IdDoc.PeriodoHasta is not empty %}
                    <p>
                        Período del {{ document.Encabezado.IdDoc.PeriodoDesde
                            | format_as('billing_document.PeriodoDesde')  }}
                        al {{ document.Encabezado.IdDoc.PeriodoHasta
                            | format_as('billing_document.PeriodoHasta')  }}
                    </p>
                {% endif %}
                {# Forma de Pago -#}
                {% if document.Encabezado.IdDoc.FmaPago is not empty %}
                    <p>Venta: {{ document.Encabezado.IdDoc.FmaPago
                        | format_as('billing_document.FmaPago') }}</p>
                {% endif %}
                {# Vendedor -#}
                {% if document.Encabezado.Emisor.CdgVendedor is not empty %}
                    <p>Venta: {{ document.Encabezado.Emisor.CdgVendedor }}</p>
                {% endif %}
            </div>
        </div>
        <div class="container container-detalles">
            <table class="tabla-detalles">
                {# Encabezados de la Tabla -#}
                <thead>
                    <tr>
                        {% set columns = {
                            'codigo': {
                                'show': (document.Detalle ?? []) | filter(detalle => detalle.CdgItem is defined and detalle.CdgItem is not empty and detalle.CdgItem.VlrCodigo is not empty) | length > 0,
                                'title': 'Código',
                                'width': '10%',
                                'align': 'left',
                                'value': 'CdgItem',
                                'format': null,
                            },
                            'item': {
                                'show': (document.Detalle ?? []) | filter(detalle => detalle.NmbItem is defined and detalle.NmbItem is not empty) | length > 0,
                                'title': 'Ítem',
                                'width': '64%',
                                'align': 'left',
                                'value': 'NmbItem',
                                'format': null,
                                'description': 'DscItem'
                            },
                            'indexe': {
                                'show': (document.Detalle ?? []) | filter(detalle => detalle.IndExe is defined and detalle.IndExe is not empty) | length > 0,
                                'title': 'IE',
                                'width': '5%',
                                'align': 'left',
                                'value': 'IndExe',
                                'format': 'indexe'
                            },
                            'cantidad': {
                                'show': (document.Detalle ?? []) | filter(detalle => detalle.QtyItem is defined and detalle.QtyItem is not empty) | length > 0,
                                'title': 'Cant.',
                                'width': '12%',
                                'align': 'right',
                                'value': 'QtyItem',
                                'format': 'number'
                            },
                            'unidad': {
                                'show': (document.Detalle ?? []) | filter(detalle => detalle.UnmdItem is defined and detalle.UnmdItem is not empty) | length > 0,
                                'title': 'Unidad',
                                'width': '10%',
                                'align': 'left',
                                'value': 'UnmdItem',
                                'format': null
                            },
                            'precio_unitario': {
                                'show': (document.Detalle ?? []) | filter(detalle => detalle.PrcItem is defined and detalle.PrcItem is not empty) | length > 0,
                                'title': 'P. Unitario',
                                'width': 'auto',
                                'align': 'right',
                                'value': 'PrcItem',
                                'format': 'number'
                            },
                            'descuento': {
                                'show': (document.Detalle ?? []) | filter(detalle => (detalle.DescuentoMonto is defined and detalle.DescuentoMonto is not empty) or (detalle.DescuentoPct is defined and detalle.DescuentoPct is not empty)) | length > 0,
                                'title': 'Descuento',
                                'width': '10%',
                                'align': 'right',
                                'value': 'DescuentoMonto',
                                'format': 'number'
                            },
                            'total_item': {
                                'show': (document.Detalle ?? []) | filter(detalle => detalle.MontoItem is not empty) | length > 0,
                                'title': 'Total Ítem',
                                'width': '12%',
                                'align': 'right',
                                'value': 'MontoItem',
                                'format': 'number'
                            }
                        } %}
                        {# Renderizar encabezados dinámicamente -#}
                        {% for key, column in columns %}
                            {% if column.show %}
                                <th style="width: {{ column.width }}; text-align: {{ column.align }};">{{ column.title }}</th>
                            {% endif %}
                        {% endfor %}
                    </tr>
                </thead>
                {# Cuerpo de la Tabla -#}
                <tbody>
                    {% set subtotal = 0 %}
                    {% for detalle in document.Detalle %}
                        <tr>
                            {% for key, column in columns %}
                                {% if column.show %}
                                    <td style="text-align: {{ column.align }};">
                                        {% if key == 'item' %}
                                            <div>
                                                {{ attribute(detalle, column.value)
                                                    | default('') }}
                                            </div>
                                            {% if attribute(detalle, column.description) is not empty %}
                                                <div style="font-size: 6pt;">
                                                    {{ attribute(detalle, column.description)
                                                        | default('') }}
                                                </div>
                                            {% endif %}
                                        {% elseif column.format == 'indexe' %}
                                            {{ detalle.IndExe == 1
                                                ? 'EX'
                                                : attribute(detalle, column.value)
                                                | default('') }}
                                        {% elseif column.format == 'number' %}
                                            {{ attribute(detalle, column.value) is not empty
                                                ? attribute(detalle, column.value)
                                                | number_format(0, ',', '.')
                                                : '' }}
                                        {% elseif key == 'codigo' %}
                                            {{ detalle.CdgItem is not empty and detalle.CdgItem.VlrCodigo is not empty
                                                ? detalle.CdgItem.VlrCodigo
                                                : '' }}
                                        {% else %}
                                            {{ attribute(detalle, column.value)
                                                | default('') }}
                                        {% endif %}
                                    </td>
                                {% endif %}
                            {% endfor %}
                        </tr>
                        {% if detalle.MontoItem is not empty %}
                            {% set subtotal = subtotal + detalle.MontoItem %}
                        {% endif %}
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% if document.DscRcgGlobal is not empty %}
        <div class="container container-montos-globales">
            <table class="tabla-montos-global">
                <tbody style="text-align: left;">
                    <tr>
                        <td class="label">
                            Subtotal:
                        </td>
                        <td>
                            {{ subtotal
                                | number_format(0, ',', '.') }}
                        </td>
                    </tr>
                    {# Descuento o Recargo #}
                    {% for descuento in document.DscRcgGlobal %}
                    <tr>
                        <td class="label">
                            {{ descuento.TpoMov
                                | trim
                                | upper == "D"
                                ? "Descuento:"
                                : "Recargo:" }}
                        </td>
                        <td>{{ descuento.ValorDR }}{{ descuento.TpoValor }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}
        {# Observación #}
        {% if document.Encabezado.IdDoc.TermPagoGlosa is not empty %}
        <div class="container-observacion">
            <p>
                <span class="bold">Observación:</span>
                {{ document.Encabezado.IdDoc.TermPagoGlosa | raw }}
            </p>
        </div>
        {% endif %}
        <div class="container informacion-bottom" {% if acuse_recibo is empty %}style="bottom: 130px;"{% endif %}>
            <table class="tabla-bottom-element">
                <tr>
                    <td class="tabla-bottom-element-cell">
                        {# Contenedor del Timbre #}
                        {% if document_stamp is not empty %}
                            <table class="tabla-timbre">
                                <tr>
                                    <td>
                                        <img class="img-timbre" src="{{ document_stamp | format_as('billing_document.TED') }}" alt="Timbre Electrónico: TED en formato PDF417">
                                    </td>
                                </tr>
                                <tr>
                                    <td class="timbre-text">Timbre Electrónico S.I.I.</td>
                                </tr>
                                <tr>
                                    {% if document_auth is not empty %}
                                        <td class="timbre-text">
                                            Resolución {{ document_auth.NroResol }} del {{ document_auth.FchResol | format_as('billing_document.FchResol') }}
                                        </td>
                                    {% endif %}
                                </tr>
                                <tr>
                                    <td class="timbre-text">Verifique documento en: www.sii.cl</td>
                                </tr>
                            </table>
                        {% endif %}
                    </td>
                    <td class="tabla-bottom-element-cell">
                        {# Acuse de Recibo -#}
                        {% if acuse_recibo is not empty %}
                            <table class="acuse-recibo">
                                <tr>
                                    <td colspan="2" class="acuse-title">Acuse de recibo</td>
                                </tr>
                                <tr>
                                    <td class="label">Nombre</td>
                                    <td class="linea">__________________________</td>
                                </tr>
                                <tr>
                                    <td class="label">RUN</td>
                                    <td class="linea">__________________________</td>
                                </tr>
                                <tr>
                                    <td class="label">Fecha</td>
                                    <td class="linea">__________________________</td>
                                </tr>
                                <tr>
                                    <td class="label">Recinto</td>
                                    <td class="linea">__________________________</td>
                                </tr>
                                <tr>
                                    <td class="label">Firma</td>
                                    <td class="linea">__________________________</td>
                                </tr>
                            </table>
                            <p class="acuse-recibo-label">
                                El acuse de recibo que se declara en este acto, de acuerdo a lo dispuesto en la letra b) del Art.4°, y la letra c) del Art. 5° de la Ley 19.983, acredita que la entrega de mercaderías o servicio(s) prestado(s) ha(n) sido recibido(s).
                            </p>
                        {% endif %}
                    </td>
                    <td class="tabla-bottom-element-cell">
                        {# Montos #}
                        <table class="tabla-montos">
                            <tbody>
                                {% set otraMoneda = document.Encabezado.Totales.TpoMoneda is not empty and document.Encabezado.Totales.TpoMoneda == 'DOLAR USA' %}
                                {# Neto -#}
                                {% if document.Encabezado.Totales.MntNeto is not empty %}
                                    <tr>
                                        <td> Neto $: </td>
                                        <td>
                                            {% if otraMoneda %}
                                                {{ document.Encabezado.Totales.MntNeto
                                                    | number_format(2, '.', ',') }}
                                            {% else %}
                                                {{ document.Encabezado.Totales.MntNeto
                                                    | number_format(0, ',', '.') }}
                                            {% endif %}
                                        </td>
                                    </tr>
                                {% endif %}
                                {# Monto -#}
                                {% if document.Encabezado.Totales.TpoMoneda is not empty %}
                                    <tr>
                                        <td> Moneda: </td>
                                        <td>
                                            {{ document.Encabezado.Totales.TpoMoneda }}
                                        </td>
                                    </tr>
                                {% endif %}
                                {# Exento -#}
                                {% if document.Encabezado.Totales.MntExe is not empty %}
                                    <tr>
                                        <td> Exento $: </td>
                                        <td>
                                            {% if otraMoneda %}
                                                {{ document.Encabezado.Totales.MntExe
                                                    | number_format(2, '.', ',') }}
                                            {% else %}
                                                {{ document.Encabezado.Totales.MntExe
                                                    | number_format(0, ',', '.') }}
                                            {% endif %}
                                        </td>
                                    </tr>
                                {% endif %}
                                {# IVA -#}
                                {% if document.Encabezado.Totales.IVA is not empty %}
                                    <tr>
                                        <td>
                                            IVA {{ document.Encabezado.Totales.TasaIVA is not empty
                                                ? '(' ~ document.Encabezado.Totales.TasaIVA ~ '%):'
                                                : '$:' }}
                                        </td>
                                        <td>
                                            {% if otraMoneda %}
                                                {{ document.Encabezado.Totales.IVA
                                                    | number_format(2, '.', ',') }}
                                            {% else %}
                                                {{ document.Encabezado.Totales.IVA
                                                    | number_format(0, ',', '.') }}
                                            {% endif %}
                                        </td>
                                    </tr>
                                {% endif %}
                                {# IVA no retenido -#}
                                {% if document.Encabezado.Totales.IVANoRet is not empty %}
                                    <tr>
                                        <td>
                                            IVA no retenido:
                                        </td>
                                        <td>
                                            {% if otraMoneda %}
                                                {{ document.Encabezado.Totales.IVANoRet
                                                    | number_format(2, '.', ',') }}
                                            {% else %}
                                                {{ document.Encabezado.Totales.IVANoRet
                                                    | number_format(0, ',', '.') }}
                                            {% endif %}
                                        </td>
                                    </tr>
                                {% endif %}
                                {# IVA adicional -#}
                                {% if document.Encabezado.Totales.ImptoReten is not empty %}
                                    {% for impuesto in document.Encabezado.Totales.ImptoReten %}
                                    <tr>
                                        <td>
                                            {{ impuesto.TipoImp }} ({{ impuesto.TasaImp }}%):
                                        </td>
                                        <td>
                                            {% if otraMoneda %}
                                                {{ impuesto.MontoImp
                                                    | number_format(2, '.', ',') }}
                                            {% else %}
                                                {{ impuesto.MontoImp
                                                    | number_format(0, ',', '.') }}
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                {% endif %}
                                {# Total -#}
                                <tr>
                                    <td>Total $:</td>
                                    <td>
                                        {% if otraMoneda %}
                                            {{ document.Encabezado.Totales.MntTotal
                                                | number_format(2, '.', ',') }}
                                        {% else %}
                                            {{ document.Encabezado.Totales.MntTotal
                                                | number_format(0, ',', '.') }}
                                        {% endif %}
                                    </td>
                                </tr>
                                {# No facturable -#}
                                {% if document.Encabezado.Totales.MontoNF is not empty %}
                                    <tr>
                                        <td>No facturable $:</td>
                                        <td>
                                            {% if otraMoneda %}
                                                {{ document.Encabezado.Totales.MontoNF
                                                    | number_format(2, '.', ',') }}
                                            {% else %}
                                                {{ document.Encabezado.Totales.MontoNF
                                                    | number_format(0, ',', '.') }}
                                            {% endif %}
                                        </td>
                                    </tr>
                                {% endif %}
                                {# Total PESO CL -#}
                                {% if document.Encabezado.OtraMoneda is not empty %}
                                    <tr>
                                        <td>Total {{ document.Encabezado.OtraMoneda.TpoMoneda }}:</td>
                                        <td>
                                            {{ document.Encabezado.OtraMoneda.MntTotOtrMnda
                                                | number_format(0, ',', '.') }}
                                        </td>
                                    </tr>
                                {% endif %}
                                {# Monto periodo -#}
                                {% if document.Encabezado.Totales.MontoPeriodo is not empty %}
                                    <tr>
                                        <td>
                                            Monto período $:
                                        </td>
                                        <td>
                                            {% if otraMoneda %}
                                                {{ document.Encabezado.Totales.MontoPeriodo
                                                    | number_format(2, '.', ',') }}
                                            {% else %}
                                                {{ document.Encabezado.Totales.MontoPeriodo
                                                    | number_format(0, ',', '.') }}
                                            {% endif %}
                                        </td>
                                    </tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </td>
                </tr>
            </table>
        </div>
        {% if acuse_recibo is not empty %}
            <div class="container container-cedible">
                <p class="cedible">
                    {% if document.Encabezado.IdDoc.TipoDTE in ['52', '56', '61'] %}
                        CEDIBLE CON SU FACTURA
                    {% else %}
                        CEDIBLE
                    {% endif %}
                </p>
            </div>
        {% endif %}
        {# Footer #}
        <footer>
            Boletas y facturas generadas con LibreDTE -
            <a href="https://www.libredte.cl" style="text-decoration: none; color: inherit;" target="_blank">
                www.libredte.cl
            </a>
        </footer>
        </div>
    </body>
</html>
